# Задача "Понимание JVM"

```java
public class JvmComprehension {
    public static void main(String[] args) {
        int i = 1;                      // 1
        Object o = new Object();        // 2
        Integer ii = 2;                 // 3
        printAll(o, i, ii);             // 4
        System.out.println("finished"); // 7
    }
    private static void printAll(Object o, int i, Integer ii) {
        Integer uselessVar = 700;                   // 5
        System.out.println(o.toString() + i + ii);  // 6
    }
}
```

<img src="Задача Понимание JVM.jpg" alt= “” width="60%" height="60%">

### Этапы работы JVM  
* ClassLoader загружает класс JvmComprehension в Metaspace
* Далее создается фрейм метода main()
1. примитивный тип int хранится непосредственно в стеке
2. выделяется память и создается объект Object в куче и ссылка на него хранится в стеке в переменной o
3. авделяется память и создается объект Integer в куче и ссылка на него хранится в стеке в переменной ii
4. создается фрейм для метода printAll()
    * передается ссылка на объект o из метода main() и хранится она будет в новой переменной o
    * передается значение переменной i, которое будет хранится в новой переменной i 
    * передается ссылка на объект ii из метода main() и хранится она будет в новой переменной ii
5. выделяется память и создается объект Integer в куче и ссылка на него хранится в стеке в переменной uslessVar
6. создается фрейм для метода System.out.println(), туда передается строка с результатом объединения трех переменных и она хранится в стеке
* после этого фрейм System.out.println() удаляется из стека как завершенный
* после этого фрейм printAll() удаляется из стека из стека как завершенный
7. создается фрейм для метода System.out.println(), туда передается строка "finished", она хранится в стеке
* после этого фрейм System.out.println() удаляется из стека как завершенный
* После этого в обратном порядке будут удалены все фреймыфреймы (сверху в низ), в куче остаются три объекта: два Integer и Object, которые будут удалены при очередном сборе мусора.
* Чистка Metaspace будет произведена при достижении Metaspace размера, заданного в MaxMetaspaceSize. Если MaxMetaspaceSize не задан, сборка мусора в Metaspace тоже осуществляется перед каждым его динамическим увеличением.


# Задача "Исследование JVM через VisualVM"

* На картинке указаны все тайм фреймы.  
* Перед выполнением программы произведен ручной запуск GC.  
* При загрузке классов видно увеличение размера Metaspace  
(единственное, не совсем понятна задержка при загрузке классов org.springfraмework, 
увеличение размера произошло на 2 секунды позже выведенного сообщения в консоль, 
как и продолжающий рост участок при загрузке io.netty, после выведенного сообщения.)    
* При первом создании 5млн объектов и последнем, размер кучи был увеличен.


<img src="Исследование%20JVM%20через%20VisualVM.jpg" alt= “” width="80%" height="80%">
